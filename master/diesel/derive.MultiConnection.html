<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This derives implements [`diesel::Connection`] and related traits for an enum of connections to different databases."><title>MultiConnection in diesel - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-0ef3deca4ed45ad8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-f501212b8b071243.css"><link rel="stylesheet" disabled href="../static.files/dark-e92fc12c34ff89d3.css"><link rel="stylesheet" disabled href="../static.files/ayu-a0090c8b1ced384f.css"><script id="default-settings" ></script><script src="../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-364b95f387bc3166.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc derive"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../diesel/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../diesel/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In diesel</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Derive Macro <a href="index.html">diesel</a>::<wbr><a class="derive" href="#">MultiConnection</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/diesel_derives/lib.rs.html#1606">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>#[derive(MultiConnection)]</code></pre><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>i-implement-a-third-party-backend-and-opt-into-breaking-changes</code></strong> only.</div></span><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This derives implements [<code>diesel::Connection</code>] and related traits for an enum of
connections to different databases.</p>
<p>By applying this derive to such an enum, you can use the enum as connection type in
any location all of the inner connections are valid. This derive supports enum
variants containing a single tuple field. Each tuple field type must implement
<code>diesel::Connection</code> and a number of related traits. Connection types form diesel itself
as well as third party connection types are supported by this derive.</p>
<p>For technical reasons this derive is currently only supported
with the “i-implement-a-third-party-backend-and-opt-into-breaking-changes”
feature enabled. As of this we do not give any stability guarantees yet.</p>
<p>The implementation of [<code>diesel::Connection::establish</code>] tries to establish
a new connection with the given connection string in the order the connections
are specified in the enum. If one connection fails it tries the next one and so on.
That means that as soon as more than one connection type accepts a certain connection
string the first matching type in your enum will always establish the connection. This
is especially important if one of the connection types is [<code>diesel::SqliteConnection</code>]
as this connection type accepts arbitary paths. It should normally placed as last entry
in your enum. If you want control about which connection type is created, just construct the
corresponding enum manually by first establishing the connection via the inner type and then
wrap the result into the enum.</p>
<h2 id="example"><a href="#example">Example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>diesel::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(diesel::MultiConnection)]
</span><span class="kw">pub enum </span>AnyConnection {
    Postgresql(diesel::PgConnection),
    Mysql(diesel::MysqlConnection),
    Sqlite(diesel::SqliteConnection),
}

<span class="macro">diesel::table! </span>{
    users {
        id -&gt; Integer,
        name -&gt; Text,
    }
}

<span class="kw">fn </span>use_multi(conn: <span class="kw-2">&amp;mut </span>AnyConnection) -&gt; QueryResult&lt;()&gt; {
   <span class="comment">// Use the connection enum as any other connection type
   // for inserting/updating/loading/…
   </span>diesel::insert_into(users::table)
       .values(users::name.eq(<span class="string">&quot;Sean&quot;</span>))
       .execute(conn)<span class="question-mark">?</span>;

   <span class="kw">let </span>users = users::table.load::&lt;(i32, String)&gt;(conn)<span class="question-mark">?</span>;

   <span class="comment">// Match on the connection type to access
   // the inner connection. This allows then to use
   // backend specifc methods.
   </span><span class="kw">if let </span>AnyConnection::Postgresql(<span class="kw-2">ref mut </span>conn) = conn {
       <span class="comment">// perform a postgresql specific query here
       </span><span class="kw">let </span>users = users::table.load::&lt;(i32, String)&gt;(conn)<span class="question-mark">?</span>;
   }

   <span class="prelude-val">Ok</span>(())
}
</code></pre></div>
<h2 id="limitations"><a href="#limitations">Limitations</a></h2>
<p>The derived connection implementation can only cover the common subset of
all inner connection types. So if one backend does not support certain SQL features,
like for example returning clauses, the whole connection implementation does not
support this feature. In addition only a limited set of SQL types is supported:</p>
<ul>
<li><code>diesel::sql_types::SmallInt</code></li>
<li><code>diesel::sql_types::Integer</code></li>
<li><code>diesel::sql_types::BigInt</code></li>
<li><code>diesel::sql_types::Double</code></li>
<li><code>diesel::sql_types::Float</code></li>
<li><code>diesel::sql_types::Text</code></li>
<li><code>diesel::sql_types::Date</code></li>
<li><code>diesel::sql_types::Time</code></li>
<li><code>diesel::sql_types::Timestamp</code></li>
</ul>
<p>Support for additional types can be added by providing manual implementations of
<code>HasSqlType</code>, <code>FromSql</code> and <code>ToSql</code> for the corresponding type + the generated
database backend.</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="diesel" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0-nightly (e1eaa2d5d 2023-02-06)" data-search-js="search-28136cea55c34037.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>